# kotlin协程的使用

## 背景
虽然工作的项目中并没有引入kotlin协程，但是面试的过程中经常会问kotlin协程相关的问题


## 协程的基本理解

协程本质就是一个作用域，这个作用域会放在一个线程当中去执行。根据传入不同的Dispatchers然后把block代码块放到不同的线程去执行
- Disptachers.IO:处理io密集型的任务，也就是本身不会消耗cpu资源，但是会中断
- Dispatchers.default:处理计算密集型的任务，也就是消耗cpu资源的任务
- Dispatchers.Main：主线程，会直接抛一个runnable到主线程，适用于ui更新的场景

## 协程的基本使用

### lifecycleScope.launch

开启一个协程作用域，根据传入的dispatchers进行block的分发，对于dispatchers.Main是直接抛到消息队列

### withContext

该作用域里边的block代码是同步执行的，不会抛到消息队列，适用于多个网络请求时，下一个请求依赖上一个请求的结果的情况，可以顺序方式解决地狱回调问题

### async

立即返回结果，只有当返回结果调用await得时候才会阻塞





## 协程的本质


本质还是需要理解线程的切换恢复机制，协程的切换也没有变化花样，还是利用jvm的能力，但是协程在解决地狱回调问题的时候，引入了continution让他在各个阻塞函数之间传递，进而达到过程管理的效果

本质就是对于每一个suspend函数在编译的时候，协程作用域都会生成一个有限自动机，来实现回调地狱的解决。本地就是线程切换结合有限自动机


